<?xml version="1.0" encoding="UTF-8"?>
<templates xml:space="preserve">
    <t t-name="hrms_dashboard.ZohoDashboard">
        <div class="zoho_spa_wrapper" t-ref="dashboardWrapper">
            <!-- Loading State -->
            <t t-if="state.loading">
                <div class="zoho_fullscreen_loader">
                    <div class="zoho_spinner"/>
                    <p>Loading Dashboard...</p>
                </div>
            </t>

            <t t-else="">
                <!-- PERSISTENT LEFT SIDEBAR -->
                <aside class="zoho_persistent_sidebar">
                    <div class="zoho_sidebar_brand">
                        <img class="brand_logo" src="/hrms_dashboard/static/description/perfectHR.jpg" alt="HR Dashboard"/>
                    </div>
                    <nav class="zoho_sidebar_nav">
                        <t t-foreach="sidebarItems" t-as="item" t-key="item.id">
                            <div class="zoho_nav_item"
                                t-att-class="{
                                    'is-active': (embeddedState.activeSidebarItem === item.id) ||
                                                (!embeddedState.activeSidebarItem and !embeddedState.isEmbeddedMode and state.currentView === item.id) ||
                                                (!embeddedState.activeSidebarItem and !embeddedState.isEmbeddedMode and item.action === state.currentView)
                                }"
                                t-on-click="() => this.onSidebarClick(item)"
                                t-att-title="item.label">
                                <span class="nav_item_icon" t-esc="item.icon"/>
                                <span class="nav_item_label" t-esc="item.label"/>
                            </div>
                        </t>
                    </nav>
                </aside>

                <!-- MAIN CONTENT AREA -->
                <div class="zoho_main_area">
                    <!-- PERSISTENT TOP HEADER -->
                    <header class="zoho_persistent_header">
                        <div class="header_left">
                            <t t-if="!embeddedState.isEmbeddedMode">
                                <div class="header_tabs">
                                    <t t-foreach="mainTabs" t-as="tab" t-key="tab.id">
                                        <button class="header_tab"
                                                t-att-class="{ 'is-active': state.activeMainTab === tab.id }"
                                                t-on-click="() => this.onMainTabClick(tab.id)"
                                                t-esc="tab.label"/>
                                    </t>
                                </div>
                            </t>
                            <t t-else="">
                                <div class="header_breadcrumb">
                                    <button class="breadcrumb_home" t-on-click="closeEmbeddedView">
                                        üè† Dashboard
                                    </button>
                                    <span class="breadcrumb_divider">‚Ä∫</span>
                                    <t t-foreach="embeddedState.breadcrumbs" t-as="crumb" t-key="crumb_index">
                                        <span class="breadcrumb_item"
                                              t-att-class="{ 'is-current': crumb_index === embeddedState.breadcrumbs.length - 1 }"
                                              t-on-click="() => this.onBreadcrumbClick(crumb, crumb_index)"
                                              t-esc="crumb.name"/>
                                        <span t-if="crumb_index &lt; embeddedState.breadcrumbs.length - 1" 
                                              class="breadcrumb_divider">‚Ä∫</span>
                                    </t>
                                </div>
                            </t>
                        </div>
                        <div class="header_right">
                            <div class="header_clock">
                                <span class="clock_time" t-esc="formattedCurrentTime"/>
                                <span class="clock_date" t-esc="formattedCurrentDate"/>
                            </div>
                            
                            <!-- User Menu Icons -->
                            <div class="header_user_menu">
                                <!-- Activities -->
                                <div class="header_icon_btn" t-on-click="openActivities" title="Activities">
                                    <span class="icon_emoji">üïê</span>
                                    <span t-if="state.activityCount > 0" class="icon_badge" t-esc="state.activityCount"/>
                                </div>
                                
                                <!-- Messages -->
                                <div class="header_icon_btn" t-on-click="openMessages" title="Messages">
                                    <span class="icon_emoji">üí¨</span>
                                    <span t-if="state.messageCount > 0" class="icon_badge" t-esc="state.messageCount"/>
                                </div>
                                
                                <!-- Notifications Bell -->
                                <div class="header_icon_btn" t-on-click="() => this.onSidebarClick({id: 'home', action: 'home'})" title="Notifications">
                                    <span class="icon_emoji">üîî</span>
                                </div>
                                
                                <!-- User Profile Dropdown -->
                                <div class="header_user_dropdown" t-on-click="toggleUserMenu">
                                    <div class="user_avatar_small">
                                        <t t-if="state.employee?.image_128">
                                            <img t-att-src="'data:image/png;base64,' + state.employee.image_128" alt=""/>
                                        </t>
                                        <t t-else="">
                                            <span class="avatar_placeholder">üë§</span>
                                        </t>
                                    </div>
                                    <div class="user_info_mini">
                                        <span class="user_name_mini" t-esc="userName"/>
                                        <span class="company_name_mini" t-esc="userCompanyName"/>
                                    </div>
                                    <span class="dropdown_arrow">‚ñº</span>
                                    
                                    <!-- Dropdown Menu -->
                                    <div t-if="state.userMenuOpen" class="user_dropdown_menu">
                                        <div class="dropdown_header">
                                            <div class="dropdown_avatar">
                                                <t t-if="state.employee?.image_128">
                                                    <img t-att-src="'data:image/png;base64,' + state.employee.image_128" alt=""/>
                                                </t>
                                                <t t-else="">
                                                    <span class="avatar_placeholder_lg">üë§</span>
                                                </t>
                                            </div>
                                            <div class="dropdown_user_info">
                                                <span class="dropdown_user_name" t-esc="userName"/>
                                                <span class="dropdown_user_email" t-esc="state.employee?.work_email || ''"/>
                                            </div>
                                        </div>
                                        <div class="dropdown_divider"/>
                                        <div class="dropdown_item" t-on-click.stop="openUserPreferences">
                                            <span class="dropdown_icon">‚öôÔ∏è</span>
                                            <span>Preferences</span>
                                        </div>
                                        <div class="dropdown_item" t-on-click.stop="() => this.onSidebarClick({id: 'profile', action: 'profile'})">
                                            <span class="dropdown_icon">üë§</span>
                                            <span>My Profile</span>
                                        </div>
                                        <t t-if="state.companies.length > 1">
                                            <div class="dropdown_divider"/>
                                            <div class="dropdown_section_title">Switch Company</div>
                                            <t t-foreach="state.companies" t-as="company" t-key="company.id">
                                                <div class="dropdown_item company_item" 
                                                     t-att-class="{'active': state.currentCompany?.id === company.id}">
                                                    <span class="dropdown_icon">üè¢</span>
                                                    <span t-esc="company.name"/>
                                                </div>
                                            </t>
                                        </t>
                                        <div class="dropdown_divider"/>
                                        <div class="dropdown_item logout_item" t-on-click.stop="onLogout">
                                            <span class="dropdown_icon">üö™</span>
                                            <span>Log Out</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </header>

                    <!-- APP SUBMENU BAR (When embedded with menus from Operations) -->
                    <t t-if="embeddedState.isEmbeddedMode and embeddedState.currentMenus.length > 0">
                        <div class="zoho_app_menubar">
                            <div class="menubar_items">
                                <t t-foreach="embeddedState.currentMenus" t-as="menu" t-key="menu.id">
                                    <div class="menubar_item" t-on-click="() => this.onEmbeddedMenuClick(menu)">
                                        <span t-esc="menu.name"/>
                                        <span t-if="menu.children and menu.children.length" class="menubar_arrow">‚ñº</span>
                                        <t t-if="menu.children and menu.children.length">
                                            <div class="menubar_dropdown">
                                                <t t-foreach="menu.children" t-as="child" t-key="child.id">
                                                    <div class="menubar_dropdown_item"
                                                        t-on-click.stop="() => this.onEmbeddedMenuClick(child)"
                                                        t-esc="child.name"/>
                                                </t>
                                            </div>
                                        </t>
                                    </div>
                                </t>
                            </div>
                            <div class="menubar_actions">
                                <!-- View Type Switchers -->
                                <t t-foreach="embeddedState.availableViewTypes" t-as="viewType" t-key="viewType">
                                    <t t-if="viewType !== 'form'">
                                        <button class="view_switch_btn" 
                                                t-att-class="{'active': embeddedState.currentViewType === viewType}"
                                                t-on-click="() => this.switchEmbeddedViewType(viewType)" 
                                                t-att-title="viewType.charAt(0).toUpperCase() + viewType.slice(1) + ' View'">
                                            <t t-if="viewType === 'list'">üìã</t>
                                            <t t-elif="viewType === 'kanban'">üìä</t>
                                            <t t-elif="viewType === 'calendar'">üìÖ</t>
                                            <t t-elif="viewType === 'graph'">üìà</t>
                                            <t t-elif="viewType === 'pivot'">üî¢</t>
                                            <t t-elif="viewType === 'activity'">‚úì</t>
                                            <t t-else="">üìÑ</t>
                                        </button>
                                    </t>
                                </t>
                                
                                <!-- Back button for form view -->
                                <button class="view_switch_btn" 
                                        t-on-click="() => this.goBackFromForm()" 
                                        t-if="embeddedState.currentViewType === 'form'"
                                        title="Back to List">‚¨ÖÔ∏è</button>
                                
                                <button class="menubar_refresh_btn" t-on-click="refreshEmbeddedView" title="Refresh">üîÑ</button>
                                <button class="menubar_close_btn" t-on-click="closeEmbeddedView">‚úï Close</button>
                            </div>
                        </div>
                    </t>

                    <!-- SIMPLE TITLE BAR (When embedded without menus - e.g., from sidebar) -->
                    <t t-if="embeddedState.isEmbeddedMode and !embeddedState.currentMenus.length">
                        <div class="zoho_embedded_titlebar">
                            <h3 t-esc="embeddedState.viewTitle"/>
                            <div class="titlebar_actions">
                                <t t-foreach="embeddedState.availableViewTypes" t-as="viewType" t-key="viewType">
                                    <t t-if="viewType !== 'form'">
                                        <button class="titlebar_btn view_switch_btn" 
                                                t-att-class="{'active': embeddedState.currentViewType === viewType}"
                                                t-on-click="() => this.switchEmbeddedViewType(viewType)" 
                                                t-att-title="viewType.charAt(0).toUpperCase() + viewType.slice(1) + ' View'">
                                            <t t-if="viewType === 'list'">üìã</t>
                                            <t t-elif="viewType === 'kanban'">üìä</t>
                                            <t t-elif="viewType === 'calendar'">üìÖ</t>
                                            <t t-elif="viewType === 'graph'">üìà</t>
                                            <t t-elif="viewType === 'pivot'">üî¢</t>
                                            <t t-elif="viewType === 'activity'">‚úì</t>
                                            <t t-else="">üìÑ</t>
                                        </button>
                                    </t>
                                </t>
                                <button class="titlebar_btn view_switch_btn" 
                                        t-on-click="() => this.goBackFromForm()" 
                                        t-if="embeddedState.currentViewType === 'form'"
                                        title="Back to List">‚¨ÖÔ∏è</button>
                                <button class="titlebar_refresh_btn" t-on-click="refreshEmbeddedView" title="Refresh">üîÑ</button>
                                <button class="titlebar_close_btn" t-on-click="closeEmbeddedView">‚úï Close</button>
                            </div>
                        </div>
                    </t>

                    <!-- CONTENT CONTAINER -->
                    <div class="zoho_content_container">
                        <!-- ==================== EMBEDDED VIEW ==================== -->
                        <t t-if="embeddedState.isEmbeddedMode">
                            <div class="zoho_embedded_view_container" t-ref="embeddedContainer">
                                <!-- LOADER: Only show when explicitly loading -->
                                <div t-if="embeddedState.loading" class="embedded_loader">
                                    <div class="zoho_spinner"/>
                                    <p>Loading view...</p>
                                </div>
                                
                                <!-- ERROR: Show if there's an error message -->
                                <div t-if="!embeddedState.loading and embeddedState.errorMessage" class="embedded_error">
                                    <div class="error_icon">‚ö†Ô∏è</div>
                                    <p t-esc="embeddedState.errorMessage"/>
                                    <div class="error_buttons">
                                        <button class="btn_primary" t-on-click="closeEmbeddedView">Return to Dashboard</button>
                                    </div>
                                </div>
                                
                                <!-- CLIENT ACTION: When we have a client action component -->
                                <div t-if="!embeddedState.loading and !embeddedState.errorMessage and embeddedState.isClientAction and embeddedState.clientActionComponent"
                                    class="embedded_client_action_wrapper"
                                    t-att-data-action-tag="embeddedState.clientActionProps?.action?.tag">
                                    <DynamicAction 
                                        component="embeddedState.clientActionComponent" 
                                        t-props="embeddedState.clientActionProps"/>
                                </div>
                                
                                <!-- STANDARD VIEW: When we have viewProps for a standard view -->
                                <div t-if="!embeddedState.loading and !embeddedState.errorMessage and !embeddedState.isClientAction and embeddedState.viewProps and embeddedState.viewProps.resModel"
                                    class="embedded_view_wrapper" 
                                    t-att-data-view-type="embeddedState.currentViewType"
                                    t-att-data-res-model="embeddedState.viewProps.resModel">
                                    <View 
                                        t-props="embeddedState.viewProps" 
                                        t-key="embeddedState.viewKey"
                                    />
                                </div>
                                
                                <!-- FALLBACK: Nothing ready but not in any other state -->
                                <div t-if="!embeddedState.loading and !embeddedState.errorMessage and !embeddedState.isClientAction and !embeddedState.viewProps" 
                                    class="embedded_error">
                                    <div class="error_icon">üîÑ</div>
                                    <p>Initializing view...</p>
                                </div>
                            </div>
                        </t>

                        <!-- ==================== HOME VIEW ==================== -->
                        <t t-if="state.currentView === 'home' and !embeddedState.isEmbeddedMode">
                            <div class="zoho_home_view">
                                <!-- Employee Profile Panel -->
                                <aside class="zoho_profile_panel">
                                    <div class="profile_card">
                                        <div class="profile_avatar">
                                            <t t-if="state.employee and state.employee.image_1920">
                                                <img t-att-src="'data:image/png;base64,' + state.employee.image_1920" alt="Avatar"/>
                                            </t>
                                            <t t-else="">
                                                <span class="avatar_placeholder">üë§</span>
                                            </t>
                                            <span class="avatar_status" t-att-class="{ 'is-online': state.employee and state.employee.attendance_state === 'checked_in' }"/>
                                        </div>

                                        <h3 class="profile_name">
                                            <t t-if="state.employee" t-esc="state.employee.name"/>
                                            <t t-else="">Welcome</t>
                                        </h3>
                                        <p class="profile_job">
                                            <t t-if="state.employee and state.employee.job_id" t-esc="state.employee.job_id[1]"/>
                                        </p>

                                        <div class="attendance_widget" t-att-class="{ 'is-checked-in': state.employee and state.employee.attendance_state === 'checked_in' }">
                                            <div class="attendance_status">
                                                <t t-if="state.employee and state.employee.attendance_state === 'checked_in'">
                                                    <span class="status_checked_in">‚úì Checked In</span>
                                                </t>
                                                <t t-else="">
                                                    <span class="status_checked_out">‚óã Not Checked In</span>
                                                </t>
                                            </div>
                                            <div class="attendance_timer" t-esc="formattedTimer"/>
                                        </div>

                                        <button class="attendance_btn" t-att-class="{ 'is-checkout': state.employee and state.employee.attendance_state === 'checked_in' }" t-on-click="onCheckInOut">
                                            <t t-if="state.employee and state.employee.attendance_state === 'checked_in'">CHECK-OUT</t>
                                            <t t-else="">CHECK-IN</t>
                                        </button>

                                        <div class="quick_stats">
                                            <div class="quick_stat" t-on-click="openPayslips">
                                                <span class="qs_value" t-esc="state.employee?.payslip_count or 0"/>
                                                <span class="qs_label">Payslips</span>
                                            </div>
                                            <div class="quick_stat" t-on-click="openTimesheets">
                                                <span class="qs_value" t-esc="state.employee?.emp_timesheets or 0"/>
                                                <span class="qs_label">Timesheets</span>
                                            </div>
                                            <div class="quick_stat" t-on-click="openContracts">
                                                <span class="qs_value" t-esc="state.employee?.contracts_count or 0"/>
                                                <span class="qs_label">Contracts</span>
                                            </div>
                                        </div>

                                        <t t-if="state.leaveBalances.length">
                                            <div class="leave_balance_section">
                                                <h4>Leave Balance</h4>
                                                <t t-foreach="state.leaveBalances" t-as="bal" t-key="bal.id">
                                                    <div class="leave_balance_row">
                                                        <div class="lb_header">
                                                            <span class="lb_type" t-esc="bal.type"/>
                                                            <span class="lb_count"><t t-esc="bal.remaining"/>/<t t-esc="bal.allocated"/></span>
                                                        </div>
                                                        <div class="lb_bar">
                                                            <div class="lb_fill" t-attf-style="width: {{ bal.allocated > 0 ? (bal.remaining / bal.allocated) * 100 : 0 }}%"/>
                                                        </div>
                                                    </div>
                                                </t>
                                            </div>
                                        </t>

                                        <t t-if="state.isManager">
                                            <div class="manager_actions_section">
                                                <h4>Manager Actions</h4>
                                                <div class="manager_action_row" t-on-click="openLeaveRequests">
                                                    <span>Leave Requests</span>
                                                    <strong t-esc="state.employee?.leaves_to_approve or 0"/>
                                                </div>
                                                <div class="manager_action_row" t-on-click="openLeavesToday">
                                                    <span>On Leave Today</span>
                                                    <strong t-esc="state.employee?.leaves_today or 0"/>
                                                </div>
                                                <div class="manager_action_row" t-on-click="openJobApplications">
                                                    <span>Applications</span>
                                                    <strong t-esc="state.employee?.job_applications or 0"/>
                                                </div>
                                            </div>
                                        </t>
                                    </div>

                                    <t t-if="state.teamMembers.length">
                                        <div class="team_card">
                                            <h4>My Team</h4>
                                            <div class="team_list">
                                                <t t-foreach="state.teamMembers" t-as="member" t-key="member.id">
                                                    <div class="team_member" t-on-click="() => this.openTeamMember(member)">
                                                        <div class="tm_avatar">
                                                            <t t-if="member.image">
                                                                <img t-att-src="'data: image/png;base64,' + member.image" alt=""/>
                                                            </t>
                                                            <t t-else="">üë§</t>
                                                            <span class="tm_status" t-att-class="{ 'is-online': member.status === 'checked_in' }"/>
                                                        </div>
                                                        <div class="tm_info">
                                                            <span class="tm_name" t-esc="member.name"/>
                                                            <span class="tm_job" t-esc="member.job"/>
                                                        </div>
                                                    </div>
                                                </t>
                                            </div>
                                        </div>
                                    </t>
                                </aside>

                                <!-- Main Dashboard Area -->
                                <main class="zoho_dashboard_content">
                                    <t t-if="currentAnnouncement">
                                        <div class="announcement_banner">
                                            <span class="ab_icon">üì¢</span>
                                            <span class="ab_text" t-esc="currentAnnouncement.announcement_reason"/>
                                            <div class="ab_dots">
                                                <t t-foreach="state.announcements" t-as="a" t-key="a_index">
                                                    <span class="ab_dot" t-att-class="{ 'is-active': a_index === state.currentAnnouncementIndex }"/>
                                                </t>
                                            </div>
                                        </div>
                                    </t>

                                    <div class="welcome_section">
                                        <h2>Welcome back, <t t-if="state.employee and state.employee.name" t-esc="state.employee.name.split(' ')[0]"/><t t-else="">User</t>!üëã</h2>
                                        <p>Here's what's happening today</p>
                                    </div>

                                    <div class="content_tabs">
                                        <t t-foreach="contentTabs" t-as="tab" t-key="tab.id">
                                            <button class="content_tab"
                                                    t-att-class="{ 'is-active': state.activeTab === tab.id }"
                                                    t-on-click="() => this.onTabClick(tab.id)"
                                                    t-esc="tab.label"/>
                                        </t>
                                    </div>

                                    <div class="tab_panels">
                                        <!-- Activities Tab -->
                                        <div class="tab_panel" t-att-class="{ 'is-active': state.activeTab === 'activities' }">
                                            <div class="stats_grid">
                                                <div class="stat_card" t-on-click="openPayslips">
                                                    <div class="sc_icon">üí∞</div>
                                                    <div class="sc_value" t-esc="state.employee?.payslip_count or 0"/>
                                                    <div class="sc_label">Payslips</div>
                                                </div>
                                                <div class="stat_card" t-on-click="openTimesheets">
                                                    <div class="sc_icon">‚è±Ô∏è</div>
                                                    <div class="sc_value" t-esc="state.employee?.emp_timesheets or 0"/>
                                                    <div class="sc_label">Timesheets</div>
                                                </div>
                                                <div class="stat_card" t-on-click="openContracts">
                                                    <div class="sc_icon">üìÑ</div>
                                                    <div class="sc_value" t-esc="state.employee?.contracts_count or 0"/>
                                                    <div class="sc_label">Contracts</div>
                                                </div>
                                                <div class="stat_card">
                                                    <div class="sc_icon">üìä</div>
                                                    <div class="sc_value" t-esc="state.employee?.broad_factor or 0"/>
                                                    <div class="sc_label">Broad Factor</div>
                                                </div>
                                            </div>

                                            <div class="info_row">
                                                <div class="info_card">
                                                    <h4>Personal Information</h4>
                                                    <div class="info_grid">
                                                        <div class="info_field">
                                                            <label>Experience</label>
                                                            <p t-esc="state.employee?.experience or '-'"/>
                                                        </div>
                                                        <div class="info_field">
                                                            <label>Email</label>
                                                            <p t-esc="state.employee?.work_email or '-'"/>
                                                        </div>
                                                        <div class="info_field">
                                                            <label>Department</label>
                                                            <p t-if="state.employee?.department_id" t-esc="state.employee.department_id[1]"/>
                                                            <p t-else="">-</p>
                                                        </div>
                                                        <div class="info_field">
                                                            <label>Phone</label>
                                                            <p t-esc="state.employee?.mobile_phone or '-'"/>
                                                        </div>
                                                    </div>
                                                </div>
                                                <t t-if="state.skills.length">
                                                    <div class="skills_card">
                                                        <h4>My Skills</h4>
                                                        <div class="skills_list">
                                                            <t t-foreach="state.skills" t-as="skill" t-key="skill.id">
                                                                <div class="skill_row">
                                                                    <div class="skill_header">
                                                                        <span t-esc="skill.name"/>
                                                                        <span><t t-esc="skill.progress"/>%</span>
                                                                    </div>
                                                                    <div class="skill_bar">
                                                                        <div class="skill_fill" t-attf-style="width: {{ skill.progress }}%"/>
                                                                    </div>
                                                                </div>
                                                            </t>
                                                        </div>
                                                    </div>
                                                </t>
                                            </div>

                                            <div class="chart_card">
                                                <h4>Leave Trend</h4>
                                                <div class="chart_container">
                                                    <canvas id="zohoLeaveChart"/>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Attendance Tab -->
                                        <div class="tab_panel" t-att-class="{ 'is-active': state.activeTab === 'attendance' }">
                                            <div class="section_header">
                                                <h3>Attendance Records</h3>
                                                <div class="section_actions">
                                                    <button class="btn_outline" t-on-click="openAllAttendance">View All</button>
                                                    <button class="btn_primary" t-on-click="addAttendance">+ Add</button>
                                                </div>
                                            </div>
                                            <div class="data_table_wrapper">
                                                <table class="data_table">
                                                    <thead>
                                                        <tr>
                                                            <th>Date</th>
                                                            <th>Sign In</th>
                                                            <th>Sign Out</th>
                                                            <th>Worked Hours</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        <t t-foreach="state.attendance" t-as="att" t-key="att.id">
                                                            <tr t-on-click="() => this.onAttendanceRowClick(att)">
                                                                <td t-esc="att.date"/>
                                                                <td t-esc="att.sign_in"/>
                                                                <td t-esc="att.sign_out"/>
                                                                <td t-esc="att.worked_hours"/>
                                                            </tr>
                                                        </t>
                                                        <t t-if="!state.attendance.length">
                                                            <tr><td colspan="4" class="empty_cell">No records found</td></tr>
                                                        </t>
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>

                                        <!-- Leaves Tab -->
                                        <div class="tab_panel" t-att-class="{ 'is-active': state.activeTab === 'leaves' }">
                                            <div class="section_header">
                                                <h3>Leave Records</h3>
                                                <div class="section_actions">
                                                    <button class="btn_outline" t-on-click="openAllLeaves">View All</button>
                                                    <button class="btn_primary" t-on-click="addLeave">+ Add</button>
                                                </div>
                                            </div>
                                            <t t-if="state.leaveBalances.length">
                                                <div class="balance_cards">
                                                    <t t-foreach="state.leaveBalances" t-as="bal" t-key="bal.id">
                                                        <div class="balance_card">
                                                            <div class="bc_value" t-esc="bal.remaining"/>
                                                            <div class="bc_type" t-esc="bal.type"/>
                                                            <div class="bc_total">of <t t-esc="bal.allocated"/> days</div>
                                                        </div>
                                                    </t>
                                                </div>
                                            </t>
                                            <div class="data_table_wrapper">
                                                <table class="data_table">
                                                    <thead>
                                                        <tr>
                                                            <th>From</th>
                                                            <th>To</th>
                                                            <th>Type</th>
                                                            <th>Status</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        <t t-foreach="state.leaves" t-as="leave" t-key="leave.id">
                                                            <tr t-on-click="() => this.onLeaveRowClick(leave)">
                                                                <td t-esc="leave.request_date_from"/>
                                                                <td t-esc="leave.request_date_to"/>
                                                                <td t-esc="leave.type"/>
                                                                <td><span class="status_badge" t-att-style="'background: ' + leave.color" t-esc="leave.state"/></td>
                                                            </tr>
                                                        </t>
                                                        <t t-if="!state.leaves.length">
                                                            <tr><td colspan="4" class="empty_cell">No records found</td></tr>
                                                        </t>
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>

                                        <!-- Expenses Tab -->
                                        <div class="tab_panel" t-att-class="{ 'is-active': state.activeTab === 'expenses' }">
                                            <div class="section_header">
                                                <h3>Expense Records</h3>
                                                <div class="section_actions">
                                                    <button class="btn_outline" t-on-click="openAllExpenses">View All</button>
                                                    <button class="btn_primary" t-on-click="addExpense">+ Add</button>
                                                </div>
                                            </div>
                                            <div class="data_table_wrapper">
                                                <table class="data_table">
                                                    <thead>
                                                        <tr>
                                                            <th>Date</th>
                                                            <th>Description</th>
                                                            <th>Amount</th>
                                                            <th>Status</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        <t t-foreach="state.expenses" t-as="exp" t-key="exp.id">
                                                            <tr t-on-click="() => this.onExpenseRowClick(exp)">
                                                                <td t-esc="exp.date"/>
                                                                <td t-esc="exp.name"/>
                                                                <td t-esc="exp.total_amount"/>
                                                                <td><span class="status_badge" t-att-style="'background:' + exp.color" t-esc="exp.state"/></td>
                                                            </tr>
                                                        </t>
                                                        <t t-if="!state.expenses.length">
                                                            <tr><td colspan="4" class="empty_cell">No records found</td></tr>
                                                        </t>
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>

                                        <!-- Projects Tab -->
                                        <div class="tab_panel" t-att-class="{ 'is-active': state.activeTab === 'projects' }">
                                            <div class="section_header">
                                                <h3>My Tasks</h3>
                                                <div class="section_actions">
                                                    <button class="btn_outline" t-on-click="openAllProjects">View All</button>
                                                    <button class="btn_primary" t-on-click="addProject">+ Add</button>
                                                </div>
                                            </div>
                                            <div class="data_table_wrapper">
                                                <table class="data_table">
                                                    <thead>
                                                        <tr>
                                                            <th>Project</th>
                                                            <th>Task</th>
                                                            <th>Due Date</th>
                                                            <th>Stage</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        <t t-foreach="state.projects" t-as="proj" t-key="proj.id">
                                                            <tr t-on-click="() => this.onProjectRowClick(proj)">
                                                                <td t-esc="proj.project_name"/>
                                                                <td t-esc="proj.task_name"/>
                                                                <td t-esc="proj.date_deadline"/>
                                                                <td><span class="status_badge" style="background:#6c757d;" t-esc="proj.stage_name"/></td>
                                                            </tr>
                                                        </t>
                                                        <t t-if="!state.projects.length">
                                                            <tr><td colspan="4" class="empty_cell">No tasks found</td></tr>
                                                        </t>
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>

                                        <!-- Notifications Tab -->
                                        <div class="tab_panel" t-att-class="{ 'is-active': state.activeTab === 'notifications' }">
                                            <div class="notif_grid">
                                                <div class="notif_card">
                                                    <h4>üéÇ Upcoming Birthdays</h4>
                                                    <t t-foreach="state.birthdays" t-as="b" t-key="b.id">
                                                        <div class="notif_item">
                                                            <strong t-esc="b.name"/>
                                                            <span t-esc="b.birthday"/>
                                                        </div>
                                                    </t>
                                                    <t t-if="!state.birthdays.length">
                                                        <div class="notif_empty">No upcoming birthdays</div>
                                                    </t>
                                                </div>
                                                <div class="notif_card">
                                                    <h4>üìÖ Upcoming Events</h4>
                                                    <t t-foreach="state.events" t-as="ev" t-key="ev_index">
                                                        <div class="notif_item">
                                                            <strong t-esc="ev[1]"/>
                                                            <span t-esc="ev[2]"/>
                                                        </div>
                                                    </t>
                                                    <t t-if="!state.events.length">
                                                        <div class="notif_empty">No upcoming events</div>
                                                    </t>
                                                </div>
                                                <div class="notif_card">
                                                    <h4>üì¢ Announcements</h4>
                                                    <t t-foreach="state.announcements" t-as="ann" t-key="ann_index">
                                                        <div class="notif_item">
                                                            <strong t-esc="ann.announcement_reason"/>
                                                        </div>
                                                    </t>
                                                    <t t-if="!state.announcements.length">
                                                        <div class="notif_empty">No announcements</div>
                                                    </t>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Manager Tab -->
                                        <t t-if="state.isManager">
                                            <div class="tab_panel" t-att-class="{ 'is-active': state.activeTab === 'manager' }">
                                                <div class="manager_grid">
                                                    <div class="manager_card" t-on-click="openLeaveRequests">
                                                        <div class="mc_icon">üìã</div>
                                                        <div class="mc_value" t-esc="state.employee?.leaves_to_approve or 0"/>
                                                        <div class="mc_label">Leave Requests</div>
                                                    </div>
                                                    <div class="manager_card" t-on-click="openLeavesToday">
                                                        <div class="mc_icon">üìÖ</div>
                                                        <div class="mc_value" t-esc="state.employee?.leaves_today or 0"/>
                                                        <div class="mc_label">On Leave Today</div>
                                                    </div>
                                                    <div class="manager_card">
                                                        <div class="mc_icon">üìÜ</div>
                                                        <div class="mc_value" t-esc="state.employee?.leaves_this_month or 0"/>
                                                        <div class="mc_label">This Month</div>
                                                    </div>
                                                    <div class="manager_card">
                                                        <div class="mc_icon">üéÅ</div>
                                                        <div class="mc_value" t-esc="state.employee?.leaves_alloc_req or 0"/>
                                                        <div class="mc_label">Allocations</div>
                                                    </div>
                                                    <div class="manager_card" t-on-click="openJobApplications">
                                                        <div class="mc_icon">üë•</div>
                                                        <div class="mc_value" t-esc="state.employee?.job_applications or 0"/>
                                                        <div class="mc_label">Applications</div>
                                                    </div>
                                                </div>
                                                <div class="chart_card" style="margin-top:24px;">
                                                    <h4>Department Distribution</h4>
                                                    <div class="chart_container">
                                                        <canvas id="zohoDeptChart"/>
                                                    </div>
                                                </div>
                                            </div>
                                        </t>
                                    </div>
                                </main>
                            </div>
                        </t>

                        <!-- ==================== TEAM VIEW ==================== -->
                        <t t-if="state.currentView === 'team' and !embeddedState.isEmbeddedMode">
                            <div class="zoho_page_content">
                                <div class="page_header">
                                    <h2>Team Overview</h2>
                                    <p>View and manage your team members</p>
                                </div>
                                <div class="action_cards_grid">
                                    <div class="action_card" t-on-click="openAllEmployees">
                                        <div class="ac_icon">üë•</div>
                                        <h4>All Employees</h4>
                                        <p>View all team members</p>
                                    </div>
                                    <div class="action_card" t-on-click="openDepartments">
                                        <div class="ac_icon">üè¢</div>
                                        <h4>Departments</h4>
                                        <p>Manage departments</p>
                                    </div>
                                    <div class="action_card" t-on-click="openOrgChart">
                                        <div class="ac_icon">üìä</div>
                                        <h4>Org Chart</h4>
                                        <p>Organization structure</p>
                                    </div>
                                    <div class="action_card" t-on-click="openLeaveRequests">
                                        <div class="ac_icon">üìã</div>
                                        <h4>Leave Requests</h4>
                                        <p>Pending approvals</p>
                                    </div>
                                </div>
                                <t t-if="state.teamMembers.length">
                                    <h3 class="section_title">My Team Members</h3>
                                    <div class="team_grid">
                                        <t t-foreach="state.teamMembers" t-as="m" t-key="m.id">
                                            <div class="team_tile" t-on-click="() => this.openTeamMember(m)">
                                                <div class="tt_avatar">
                                                    <t t-if="m.image"><img t-att-src="'data:image/png;base64,' + m.image" alt=""/></t>
                                                    <t t-else="">üë§</t>
                                                    <span class="tt_status" t-att-class="{ 'is-online': m.status === 'checked_in' }"/>
                                                </div>
                                                <div class="tt_name" t-esc="m.name"/>
                                                <div class="tt_job" t-esc="m.job"/>
                                            </div>
                                        </t>
                                    </div>
                                </t>
                            </div>
                        </t>

                        <!-- ==================== ORGANIZATION VIEW ==================== -->
                        <t t-if="state.currentView === 'organization' and !embeddedState.isEmbeddedMode">
                            <div class="zoho_page_content">
                                <div class="page_header">
                                    <h2>Organization</h2>
                                    <p>Company-wide information and settings</p>
                                </div>
                                <div class="action_cards_grid">
                                    <div class="action_card" t-on-click="openDepartments">
                                        <div class="ac_icon">üè¢</div>
                                        <h4>Departments</h4>
                                    </div>
                                    <div class="action_card" t-on-click="openOrgChart">
                                        <div class="ac_icon">üìä</div>
                                        <h4>Org Chart</h4>
                                    </div>
                                    <div class="action_card" t-on-click="openJobApplications">
                                        <div class="ac_icon">üéØ</div>
                                        <h4>Recruitment</h4>
                                    </div>
                                </div>
                            </div>
                        </t>

                        <!-- ==================== OPERATIONS VIEW ==================== -->
                        <t t-if="state.currentView === 'operations' and !embeddedState.isEmbeddedMode">
                            <div class="zoho_apps_page">
                                <div class="apps_search_wrapper">
                                    <input type="text" 
                                           class="apps_search_input"
                                           placeholder="Search applications..." 
                                           t-on-input="onSearchInput" 
                                           t-att-value="state.searchQuery"/>
                                </div>
                                <div class="apps_grid">
                                    <t t-foreach="filteredApps" t-as="app" t-key="app.id">
                                        <div class="app_tile" t-on-click="() => this.onAppClick(app)">
                                            <div class="app_icon">
                                                <t t-if="getAppIcon(app)">
                                                    <img t-att-src="getAppIcon(app)" alt=""/>
                                                </t>
                                                <t t-else="">üì¶</t>
                                            </div>
                                            <span class="app_name" t-esc="app.name"/>
                                        </div>
                                    </t>
                                    <t t-if="!filteredApps.length">
                                        <div class="apps_empty">
                                            <div class="ae_icon">üîç</div>
                                            <p>No applications found</p>
                                        </div>
                                    </t>
                                </div>
                            </div>
                        </t>

                        <!-- ==================== PROFILE VIEW ==================== -->
                        <t t-if="state.currentView === 'profile' and !embeddedState.isEmbeddedMode">
                            <div class="zoho_profile_page">
                                <div class="profile_main_card">
                                    <div class="pmc_header">
                                        <div class="pmc_avatar">
                                            <t t-if="state.employee?.image_1920">
                                                <img t-att-src="'data:image/png;base64,' + state.employee.image_1920" alt=""/>
                                            </t>
                                            <t t-else="">üë§</t>
                                        </div>
                                        <h2 t-esc="state.employee?.name or 'User'"/>
                                        <p t-if="state.employee?.job_id" t-esc="state.employee.job_id[1]"/>
                                    </div>
                                    <div class="pmc_body">
                                        <div class="pmc_info_grid">
                                            <div class="pmc_info_item">
                                                <label>Email</label>
                                                <p t-esc="state.employee?.work_email or '-'"/>
                                            </div>
                                            <div class="pmc_info_item">
                                                <label>Phone</label>
                                                <p t-esc="state.employee?.mobile_phone or '-'"/>
                                            </div>
                                            <div class="pmc_info_item">
                                                <label>Department</label>
                                                <p t-if="state.employee?.department_id" t-esc="state.employee.department_id[1]"/>
                                                <p t-else="">-</p>
                                            </div>
                                            <div class="pmc_info_item">
                                                <label>Experience</label>
                                                <p t-esc="state.employee?.experience or '-'"/>
                                            </div>
                                        </div>
                                        <t t-if="state.skills.length">
                                            <div class="pmc_skills">
                                                <h4>Skills</h4>
                                                <div class="pmc_skills_grid">
                                                    <t t-foreach="state.skills" t-as="sk" t-key="sk.id">
                                                        <div class="pmc_skill_item">
                                                            <span t-esc="sk.name"/>
                                                            <div class="pmc_skill_bar">
                                                                <div class="pmc_skill_fill" t-attf-style="width: {{ sk.progress }}%"/>
                                                            </div>
                                                        </div>
                                                    </t>
                                                </div>
                                            </div>
                                        </t>
                                        <div class="pmc_actions">
                                            <button class="btn_primary" t-on-click="openProfile">Edit Profile</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </t>
                    </div>
                </div>

                <!-- FLOATING ACTION BUTTON -->
                <div class="zoho_fab" t-att-class="{'is-open': embeddedState.fabOpen}">
                    <div class="fab_menu">
                        <div class="fab_item" t-on-click="addLeave" title="New Leave">
                            üìÖ
                            <span class="fab_item_tooltip">New Leave</span>
                        </div>
                        <div class="fab_item" t-on-click="addExpense" title="New Expense">
                            üí≥
                            <span class="fab_item_tooltip">New Expense</span>
                        </div>
                        <div class="fab_item" t-on-click="addProject" title="New Task">
                            üìã
                            <span class="fab_item_tooltip">New Task</span>
                        </div>
                    </div>
                    <button class="fab_main" t-on-click="toggleFab">+</button>
                </div>
            </t>
        </div>
    </t>
</templates>