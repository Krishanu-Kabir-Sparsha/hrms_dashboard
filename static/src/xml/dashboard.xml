<?xml version="1.0" encoding="UTF-8"?>
<templates xml:space="preserve">
    <t t-name="hrms_dashboard.ZohoDashboard">
        <div class="zoho_dashboard_wrapper">
            <!-- Loading State -->
            <t t-if="state.loading">
                <div class="zoho_loading">
                    <div class="zoho_loading_spinner"/>
                    <p class="zoho_loading_text">Loading Dashboard...</p>
                </div>
            </t>

            <t t-else="">
                <!-- Left Sidebar - Always Visible -->
                <div class="zoho_sidebar">
                    <div class="zoho_sidebar_logo">
                        <span class="logo_icon">üìä</span>
                    </div>
                    <t t-foreach="sidebarItems" t-as="item" t-key="item.id">
                        <div class="zoho_sidebar_item"
                             t-att-class="{
                                 active: state.currentView === item.id ||
                                         (item.id === 'operations' and embeddedState.isEmbeddedMode)
                             }"
                             t-on-click="() => this.onSidebarClick(item)">
                            <span class="zoho_sidebar_icon" t-esc="item.icon"/>
                            <span class="zoho_sidebar_text" t-esc="item.label"/>
                        </div>
                    </t>
                </div>

                <!-- Main Content Area -->
                <div class="zoho_main_wrapper">
                    <!-- Top Navigation Bar - Always Visible -->
                    <div class="zoho_top_nav">
                        <div class="zoho_top_nav_left">
                            <!-- Main Tabs (when not embedded) -->
                            <t t-if="!embeddedState.isEmbeddedMode">
                                <div class="zoho_top_nav_tabs">
                                    <t t-foreach="mainTabs" t-as="tab" t-key="tab.id">
                                        <div class="zoho_top_nav_tab"
                                             t-att-class="{ active: state.activeMainTab === tab.id }"
                                             t-on-click="() => this.onMainTabClick(tab.id)"
                                             t-esc="tab.label"/>
                                    </t>
                                </div>
                            </t>

                            <!-- Breadcrumbs (when embedded) -->
                            <t t-if="embeddedState.isEmbeddedMode">
                                <div class="zoho_breadcrumbs">
                                    <span class="breadcrumb_home" t-on-click="closeEmbeddedView">
                                        üè† Dashboard
                                    </span>
                                    <span class="breadcrumb_separator">‚Ä∫</span>
                                    <t t-foreach="embeddedState.breadcrumbs" t-as="crumb" t-key="crumb_index">
                                        <span class="breadcrumb_item"
                                              t-att-class="{ active: crumb_index === embeddedState.breadcrumbs.length - 1 }"
                                              t-on-click="() => this.onBreadcrumbClick(crumb, crumb_index)"
                                              t-esc="crumb.name"/>
                                        <span t-if="crumb_index &lt; embeddedState.breadcrumbs.length - 1" 
                                              class="breadcrumb_separator">‚Ä∫</span>
                                    </t>
                                </div>
                            </t>
                        </div>

                        <div class="zoho_top_nav_right">
                            <div class="zoho_current_time">
                                <span class="time_display" t-esc="formattedCurrentTime"/>
                                <span class="date_display" t-esc="formattedCurrentDate"/>
                            </div>
                            <button class="zoho_quick_add_btn" t-on-click="addLeave">+ Quick Add</button>
                        </div>
                    </div>

                    <!-- Sub Menu Bar (when embedded with menus) -->
                    <t t-if="embeddedState.isEmbeddedMode and embeddedState.currentMenus.length">
                        <div class="zoho_submenu_bar">
                            <t t-foreach="embeddedState.currentMenus" t-as="menu" t-key="menu.id">
                                <div class="zoho_submenu_item"
                                     t-att-class="{ has_children: menu.children and menu.children.length }"
                                     t-on-click="() => this.onEmbeddedMenuClick(menu)">
                                    <span t-esc="menu.name"/>
                                    <span t-if="menu.children and menu.children.length" class="submenu_arrow">‚ñº</span>

                                    <!-- Dropdown Children -->
                                    <t t-if="menu.children and menu.children.length">
                                        <div class="zoho_submenu_dropdown">
                                            <t t-foreach="menu.children" t-as="child" t-key="child.id">
                                                <div class="zoho_submenu_dropdown_item"
                                                     t-on-click.stop="() => this.onEmbeddedMenuClick(child)"
                                                     t-esc="child.name"/>
                                            </t>
                                        </div>
                                    </t>
                                </div>
                            </t>

                            <div class="zoho_submenu_actions">
                                <button class="zoho_close_btn" t-on-click="closeEmbeddedView">‚úï Back to Dashboard</button>
                            </div>
                        </div>
                    </t>

                    <!-- Simple Header for Embedded without Menus -->
                    <t t-if="embeddedState.isEmbeddedMode and !embeddedState.currentMenus.length">
                        <div class="zoho_embedded_header">
                            <h3 t-esc="embeddedState.currentApp?.name or 'View'"/>
                            <div class="zoho_embedded_actions">
                                <button class="zoho_close_btn" t-on-click="closeEmbeddedView">‚úï Back to Dashboard</button>
                            </div>
                        </div>
                    </t>

                    <!-- Content Area -->
                    <div class="zoho_content_area">

                        <!-- EMBEDDED VIEW MODE - Using View Component -->
                        <t t-if="embeddedState.isEmbeddedMode and embeddedState.showView">
                            <div class="zoho_embedded_view_wrapper">
                                <!-- Loading Overlay -->
                                <t t-if="embeddedState.loading">
                                    <div class="zoho_embedded_loading_overlay">
                                        <div class="zoho_loading_spinner"/>
                                        <p>Loading view...</p>
                                    </div>
                                </t>

                                <!-- Embedded View Container -->
                                <div class="zoho_embedded_view_container" t-ref="embeddedView">
                                    <t t-if="embeddedState.viewProps">
                                        <View t-props="embeddedState.viewProps"/>
                                    </t>
                                </div>
                            </div>
                        </t>

                        <!-- HOME VIEW -->
                        <t t-if="state.currentView === 'home' and !embeddedState.isEmbeddedMode">
                            <div class="zoho_home_layout">
                                <!-- Left: Employee Sidebar -->
                                <div class="zoho_employee_sidebar">
                                    <div class="zoho_employee_card">
                                        <div class="zoho_employee_image">
                                            <t t-if="state.employee and state.employee.image_1920">
                                                <img t-att-src="'data:image/png;base64,' + state.employee.image_1920"/>
                                            </t>
                                            <t t-else="">
                                                <span class="zoho_avatar_placeholder">üë§</span>
                                            </t>
                                            <div class="zoho_online_badge" 
                                                 t-att-class="{ online: state.employee and state.employee.attendance_state === 'checked_in' }"/>
                                        </div>

                                        <h3 class="zoho_employee_name">
                                            <t t-if="state.employee" t-esc="state.employee.name"/>
                                            <t t-else="">Welcome</t>
                                        </h3>

                                        <p class="zoho_employee_title">
                                            <t t-if="state.employee and state.employee.job_id" t-esc="state.employee.job_id[1]"/>
                                        </p>

                                        <!-- Check-in Box -->
                                        <div class="zoho_checkin_box" 
                                             t-att-class="{ checked_in: state.employee and state.employee.attendance_state === 'checked_in' }">
                                            <div class="zoho_checkin_label">
                                                <t t-if="state.employee and state.employee.attendance_state === 'checked_in'">
                                                    <span class="status_checked_in">‚úì Checked In</span>
                                                </t>
                                                <t t-else="">
                                                    <span class="status_checked_out">‚óã Yet to check-in</span>
                                                </t>
                                            </div>
                                            <div class="zoho_timer" t-esc="formattedTimer"/>
                                        </div>

                                        <button class="zoho_checkin_btn"
                                                t-att-class="{ checkout: state.employee and state.employee.attendance_state === 'checked_in' }"
                                                t-on-click="onCheckInOut">
                                            <t t-if="state.employee and state.employee.attendance_state === 'checked_in'">CHECK-OUT</t>
                                            <t t-else="">CHECK-IN</t>
                                        </button>

                                        <!-- Quick Stats -->
                                        <div class="zoho_quick_stats">
                                            <div class="zoho_quick_stat" t-on-click="openPayslips">
                                                <span class="stat_value" t-esc="state.employee?.payslip_count or 0"/>
                                                <span class="stat_label">Payslips</span>
                                            </div>
                                            <div class="zoho_quick_stat" t-on-click="openTimesheets">
                                                <span class="stat_value" t-esc="state.employee?.emp_timesheets or 0"/>
                                                <span class="stat_label">Timesheets</span>
                                            </div>
                                            <div class="zoho_quick_stat" t-on-click="openContracts">
                                                <span class="stat_value" t-esc="state.employee?.contracts_count or 0"/>
                                                <span class="stat_label">Contracts</span>
                                            </div>
                                        </div>

                                        <!-- Leave Balances -->
                                        <t t-if="state.leaveBalances.length">
                                            <div class="zoho_leave_balances">
                                                <h4>Leave Balance</h4>
                                                <t t-foreach="state.leaveBalances" t-as="balance" t-key="balance.id">
                                                    <div class="zoho_leave_balance_item">
                                                        <div class="balance_header">
                                                            <span class="balance_type" t-esc="balance.type"/>
                                                            <span class="balance_count">
                                                                <t t-esc="balance.remaining"/> / <t t-esc="balance.allocated"/>
                                                            </span>
                                                        </div>
                                                        <div class="balance_progress">
                                                            <div class="balance_progress_bar" 
                                                                 t-attf-style="width: {{ balance.allocated > 0 ? (balance.remaining / balance.allocated) * 100 : 0 }}%"/>
                                                        </div>
                                                    </div>
                                                </t>
                                            </div>
                                        </t>

                                        <!-- Manager Stats -->
                                        <t t-if="state.isManager">
                                            <div class="zoho_manager_section">
                                                <h4>Manager Stats</h4>
                                                <div class="zoho_manager_stat" t-on-click="openLeaveRequests">
                                                    <span>Leave Requests</span>
                                                    <strong t-esc="state.employee?.leaves_to_approve or 0"/>
                                                </div>
                                                <div class="zoho_manager_stat" t-on-click="openLeavesToday">
                                                    <span>Leaves Today</span>
                                                    <strong t-esc="state.employee?.leaves_today or 0"/>
                                                </div>
                                                <div class="zoho_manager_stat" t-on-click="openJobApplications">
                                                    <span>Job Applications</span>
                                                    <strong t-esc="state.employee?.job_applications or 0"/>
                                                </div>
                                            </div>
                                        </t>
                                    </div>

                                    <!-- Team Members Widget -->
                                    <t t-if="state.teamMembers.length">
                                        <div class="zoho_team_widget">
                                            <h4>Team Members</h4>
                                            <div class="zoho_team_list">
                                                <t t-foreach="state.teamMembers" t-as="member" t-key="member.id">
                                                    <div class="zoho_team_member" t-on-click="() => this.openTeamMember(member)">
                                                        <div class="member_avatar">
                                                            <t t-if="member.image">
                                                                <img t-att-src="'data:image/png;base64,' + member.image"/>
                                                            </t>
                                                            <t t-else="">üë§</t>
                                                            <span class="member_status" 
                                                                  t-att-class="{ online: member.status === 'checked_in' }"/>
                                                        </div>
                                                        <div class="member_info">
                                                            <span class="member_name" t-esc="member.name"/>
                                                            <span class="member_job" t-esc="member.job"/>
                                                        </div>
                                                    </div>
                                                </t>
                                            </div>
                                        </div>
                                    </t>
                                </div>

                                <!-- Right: Main Content -->
                                <div class="zoho_main_content">
                                    <!-- Announcement Banner -->
                                    <t t-if="currentAnnouncement">
                                        <div class="zoho_announcement_banner">
                                            <span class="announcement_icon">üì¢</span>
                                            <span class="announcement_text" t-esc="currentAnnouncement.announcement_reason"/>
                                            <div class="announcement_dots">
                                                <t t-foreach="state.announcements" t-as="ann" t-key="ann_index">
                                                    <span class="announcement_dot" 
                                                          t-att-class="{ active: ann_index === state.currentAnnouncementIndex }"/>
                                                </t>
                                            </div>
                                        </div>
                                    </t>

                                    <!-- Content Header -->
                                    <div class="zoho_content_header">
                                        <div class="zoho_greeting">
                                            <h2>
                                                Welcome back, 
                                                <t t-if="state.employee" t-esc="state.employee.name.split(' ')[0]"/>
                                                <t t-else="">User</t>!  üëã
                                            </h2>
                                            <p>Here's what's happening today</p>
                                        </div>
                                    </div>

                                    <!-- Content Tabs -->
                                    <div class="zoho_content_tabs">
                                        <t t-foreach="contentTabs" t-as="tab" t-key="tab.id">
                                            <div class="zoho_content_tab"
                                                 t-att-class="{ active: state.activeTab === tab.id }"
                                                 t-on-click="() => this.onTabClick(tab.id)"
                                                 t-esc="tab.label"/>
                                        </t>
                                    </div>

                                    <!-- Tab Panels -->
                                    <div class="zoho_tab_panels">
                                        <!-- Activities Tab -->
                                        <div class="zoho_tab_panel" t-att-class="{ active: state.activeTab === 'activities' }">
                                            <div class="zoho_stats_grid">
                                                <div class="zoho_stat_card" t-on-click="openPayslips">
                                                    <div class="stat_icon">üí∞</div>
                                                    <div class="stat_value" t-esc="state.employee?.payslip_count or 0"/>
                                                    <div class="stat_label">Payslips</div>
                                                </div>
                                                <div class="zoho_stat_card" t-on-click="openTimesheets">
                                                    <div class="stat_icon">‚è±Ô∏è</div>
                                                    <div class="stat_value" t-esc="state.employee?.emp_timesheets or 0"/>
                                                    <div class="stat_label">Timesheets</div>
                                                </div>
                                                <div class="zoho_stat_card" t-on-click="openContracts">
                                                    <div class="stat_icon">üìÑ</div>
                                                    <div class="stat_value" t-esc="state.employee?.contracts_count or 0"/>
                                                    <div class="stat_label">Contracts</div>
                                                </div>
                                                <div class="zoho_stat_card">
                                                    <div class="stat_icon">üìä</div>
                                                    <div class="stat_value" t-esc="state.employee?.broad_factor or 0"/>
                                                    <div class="stat_label">Broad Factor</div>
                                                </div>
                                            </div>

                                            <!-- Info + Skills Row -->
                                            <div class="zoho_row">
                                                <div class="zoho_info_card">
                                                    <h4>Personal Information</h4>
                                                    <div class="zoho_info_grid">
                                                        <div class="zoho_info_item">
                                                            <label>Experience</label>
                                                            <p t-esc="state.employee?.experience or '-'"/>
                                                        </div>
                                                        <div class="zoho_info_item">
                                                            <label>Email</label>
                                                            <p t-esc="state.employee?.work_email or '-'"/>
                                                        </div>
                                                        <div class="zoho_info_item">
                                                            <label>Department</label>
                                                            <p t-if="state.employee?.department_id" 
                                                               t-esc="state.employee.department_id[1]"/>
                                                            <p t-else="">-</p>
                                                        </div>
                                                        <div class="zoho_info_item">
                                                            <label>Phone</label>
                                                            <p t-esc="state.employee?.mobile_phone or '-'"/>
                                                        </div>
                                                    </div>
                                                </div>

                                                <t t-if="state.skills.length">
                                                    <div class="zoho_skills_card">
                                                        <h4>My Skills</h4>
                                                        <div class="zoho_skills_list">
                                                            <t t-foreach="state.skills" t-as="skill" t-key="skill.id">
                                                                <div class="zoho_skill_item">
                                                                    <div class="skill_header">
                                                                        <span class="skill_name" t-esc="skill.name"/>
                                                                        <span class="skill_percent"><t t-esc="skill.progress"/>%</span>
                                                                    </div>
                                                                    <div class="skill_progress">
                                                                        <div class="skill_progress_bar" 
                                                                             t-attf-style="width: {{ skill.progress }}%"/>
                                                                    </div>
                                                                </div>
                                                            </t>
                                                        </div>
                                                    </div>
                                                </t>
                                            </div>

                                            <!-- Leave Trend Chart -->
                                            <div class="zoho_chart_card">
                                                <h4>My Leave Trend</h4>
                                                <div class="zoho_chart_container">
                                                    <canvas id="zohoLeaveChart"/>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Attendance Tab -->
                                        <div class="zoho_tab_panel" t-att-class="{ active: state.activeTab === 'attendance' }">
                                            <div class="zoho_section_header">
                                                <h3>ATTENDANCE RECORDS</h3>
                                                <div class="zoho_header_actions">
                                                    <button class="zoho_view_all_btn" t-on-click="openAllAttendance">View All</button>
                                                    <button class="zoho_add_btn" t-on-click="addAttendance">+ Add</button>
                                                </div>
                                            </div>
                                            <div class="zoho_table_wrapper">
                                                <table class="zoho_table">
                                                    <thead>
                                                        <tr>
                                                            <th>Date</th>
                                                            <th>Sign In</th>
                                                            <th>Sign Out</th>
                                                            <th>Worked Hours</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        <t t-foreach="state.attendance" t-as="att" t-key="att.id">
                                                            <tr class="zoho_clickable_row" t-on-click="() => this.onAttendanceRowClick(att)">
                                                                <td t-esc="att.date"/>
                                                                <td t-esc="att.sign_in"/>
                                                                <td t-esc="att.sign_out"/>
                                                                <td t-esc="att.worked_hours"/>
                                                            </tr>
                                                        </t>
                                                        <t t-if="! state.attendance.length">
                                                            <tr>
                                                                <td colspan="4" class="zoho_empty_row">No attendance records found</td>
                                                            </tr>
                                                        </t>
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>

                                        <!-- Leaves Tab -->
                                        <div class="zoho_tab_panel" t-att-class="{ active: state.activeTab === 'leaves' }">
                                            <div class="zoho_section_header">
                                                <h3>LEAVE RECORDS</h3>
                                                <div class="zoho_header_actions">
                                                    <button class="zoho_view_all_btn" t-on-click="openAllLeaves">View All</button>
                                                    <button class="zoho_add_btn" t-on-click="addLeave">+ Add</button>
                                                </div>
                                            </div>

                                            <t t-if="state.leaveBalances.length">
                                                <div class="zoho_leave_balance_cards">
                                                    <t t-foreach="state.leaveBalances" t-as="balance" t-key="balance.id">
                                                        <div class="zoho_balance_card">
                                                            <div class="balance_card_value" t-esc="balance.remaining"/>
                                                            <div class="balance_card_label" t-esc="balance.type"/>
                                                            <div class="balance_card_sub">of <t t-esc="balance.allocated"/> days</div>
                                                        </div>
                                                    </t>
                                                </div>
                                            </t>

                                            <div class="zoho_table_wrapper">
                                                <table class="zoho_table">
                                                    <thead>
                                                        <tr>
                                                            <th>From</th>
                                                            <th>To</th>
                                                            <th>Type</th>
                                                            <th>Status</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        <t t-foreach="state.leaves" t-as="leave" t-key="leave.id">
                                                            <tr class="zoho_clickable_row" t-on-click="() => this.onLeaveRowClick(leave)">
                                                                <td t-esc="leave.request_date_from"/>
                                                                <td t-esc="leave.request_date_to"/>
                                                                <td t-esc="leave.type"/>
                                                                <td>
                                                                    <span class="zoho_badge" 
                                                                          t-att-style="'background:' + leave.color" 
                                                                          t-esc="leave.state"/>
                                                                </td>
                                                            </tr>
                                                        </t>
                                                        <t t-if="!state.leaves.length">
                                                            <tr>
                                                                <td colspan="4" class="zoho_empty_row">No leave records found</td>
                                                            </tr>
                                                        </t>
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>

                                        <!-- Expenses Tab -->
                                        <div class="zoho_tab_panel" t-att-class="{ active: state.activeTab === 'expenses' }">
                                            <div class="zoho_section_header">
                                                <h3>EXPENSE RECORDS</h3>
                                                <div class="zoho_header_actions">
                                                    <button class="zoho_view_all_btn" t-on-click="openAllExpenses">View All</button>
                                                    <button class="zoho_add_btn" t-on-click="addExpense">+ Add</button>
                                                </div>
                                            </div>
                                            <div class="zoho_table_wrapper">
                                                <table class="zoho_table">
                                                    <thead>
                                                        <tr>
                                                            <th>Date</th>
                                                            <th>Subject</th>
                                                            <th>Amount</th>
                                                            <th>Status</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        <t t-foreach="state.expenses" t-as="exp" t-key="exp.id">
                                                            <tr class="zoho_clickable_row" t-on-click="() => this.onExpenseRowClick(exp)">
                                                                <td t-esc="exp.date"/>
                                                                <td t-esc="exp.name"/>
                                                                <td t-esc="exp.total_amount"/>
                                                                <td>
                                                                    <span class="zoho_badge" 
                                                                          t-att-style="'background:' + exp.color" 
                                                                          t-esc="exp.state"/>
                                                                </td>
                                                            </tr>
                                                        </t>
                                                        <t t-if="!state.expenses.length">
                                                            <tr>
                                                                <td colspan="4" class="zoho_empty_row">No expense records found</td>
                                                            </tr>
                                                        </t>
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>

                                        <!-- Projects Tab -->
                                        <div class="zoho_tab_panel" t-att-class="{ active: state.activeTab === 'projects' }">
                                            <div class="zoho_section_header">
                                                <h3>MY TASKS</h3>
                                                <div class="zoho_header_actions">
                                                    <button class="zoho_view_all_btn" t-on-click="openAllProjects">View All</button>
                                                    <button class="zoho_add_btn" t-on-click="addProject">+ Add</button>
                                                </div>
                                            </div>
                                            <div class="zoho_table_wrapper">
                                                <table class="zoho_table">
                                                    <thead>
                                                        <tr>
                                                            <th>Project</th>
                                                            <th>Task</th>
                                                            <th>Due Date</th>
                                                            <th>Stage</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        <t t-foreach="state.projects" t-as="proj" t-key="proj.id">
                                                            <tr class="zoho_clickable_row" t-on-click="() => this.onProjectRowClick(proj)">
                                                                <td t-esc="proj.project_name"/>
                                                                <td t-esc="proj.task_name"/>
                                                                <td t-esc="proj.date_deadline"/>
                                                                <td>
                                                                    <span class="zoho_badge" style="background:#6c757d;" t-esc="proj.stage_name"/>
                                                                </td>
                                                            </tr>
                                                        </t>
                                                        <t t-if="!state.projects.length">
                                                            <tr>
                                                                <td colspan="4" class="zoho_empty_row">No tasks found</td>
                                                            </tr>
                                                        </t>
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>

                                        <!-- Notifications Tab -->
                                        <div class="zoho_tab_panel" t-att-class="{ active: state.activeTab === 'notifications' }">
                                            <div class="zoho_notifications_grid">
                                                <div class="zoho_notification_card">
                                                    <h4>üéÇ Upcoming Birthdays</h4>
                                                    <t t-foreach="state.birthdays" t-as="emp" t-key="emp.id">
                                                        <div class="zoho_notification_item">
                                                            <strong t-esc="emp.name"/>
                                                            <span t-esc="emp.birthday"/>
                                                        </div>
                                                    </t>
                                                    <t t-if="! state.birthdays.length">
                                                        <div class="zoho_empty_notification">No upcoming birthdays</div>
                                                    </t>
                                                </div>

                                                <div class="zoho_notification_card">
                                                    <h4>üìÖ Upcoming Events</h4>
                                                    <t t-foreach="state.events" t-as="event" t-key="event_index">
                                                        <div class="zoho_notification_item">
                                                            <strong t-esc="event[1]"/>
                                                            <span t-esc="event[2]"/>
                                                        </div>
                                                    </t>
                                                    <t t-if="!state.events.length">
                                                        <div class="zoho_empty_notification">No upcoming events</div>
                                                    </t>
                                                </div>

                                                <div class="zoho_notification_card">
                                                    <h4>üì¢ Announcements</h4>
                                                    <t t-foreach="state.announcements" t-as="ann" t-key="ann_index">
                                                        <div class="zoho_notification_item">
                                                            <strong t-esc="ann.announcement_reason"/>
                                                        </div>
                                                    </t>
                                                    <t t-if="!state.announcements.length">
                                                        <div class="zoho_empty_notification">No announcements</div>
                                                    </t>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Manager Tab -->
                                        <t t-if="state.isManager">
                                            <div class="zoho_tab_panel" t-att-class="{ active: state.activeTab === 'manager' }">
                                                <div class="zoho_manager_cards">
                                                    <div class="zoho_manager_card" t-on-click="openLeaveRequests">
                                                        <div class="card_icon">üìã</div>
                                                        <div class="card_value" t-esc="state.employee?.leaves_to_approve or 0"/>
                                                        <div class="card_label">Leave Requests</div>
                                                    </div>
                                                    <div class="zoho_manager_card" t-on-click="openLeavesToday">
                                                        <div class="card_icon">üìÖ</div>
                                                        <div class="card_value" t-esc="state.employee?.leaves_today or 0"/>
                                                        <div class="card_label">Leaves Today</div>
                                                    </div>
                                                    <div class="zoho_manager_card">
                                                        <div class="card_icon">üìÜ</div>
                                                        <div class="card_value" t-esc="state.employee?.leaves_this_month or 0"/>
                                                        <div class="card_label">This Month</div>
                                                    </div>
                                                    <div class="zoho_manager_card">
                                                        <div class="card_icon">üéÅ</div>
                                                        <div class="card_value" t-esc="state.employee?.leaves_alloc_req or 0"/>
                                                        <div class="card_label">Allocations</div>
                                                    </div>
                                                    <div class="zoho_manager_card" t-on-click="openJobApplications">
                                                        <div class="card_icon">üë•</div>
                                                        <div class="card_value" t-esc="state.employee?.job_applications or 0"/>
                                                        <div class="card_label">Applications</div>
                                                    </div>
                                                </div>

                                                <div class="zoho_chart_card" style="margin-top: 24px;">
                                                    <h4>Department Distribution</h4>
                                                    <div class="zoho_chart_container">
                                                        <canvas id="zohoDeptChart"/>
                                                    </div>
                                                </div>
                                            </div>
                                        </t>
                                    </div>
                                </div>
                            </div>
                        </t>

                        <!-- TEAM VIEW -->
                        <t t-if="state.currentView === 'team' and ! embeddedState.isEmbeddedMode">
                            <div class="zoho_team_view">
                                <div class="zoho_view_header">
                                    <h2>Team Overview</h2>
                                    <p>View and manage your team members</p>
                                </div>
                                <div class="zoho_team_cards">
                                    <div class="zoho_team_card" t-on-click="openAllEmployees">
                                        <div class="team_card_icon">üë•</div>
                                        <h4>All Employees</h4>
                                        <p>View all team members</p>
                                    </div>
                                    <div class="zoho_team_card" t-on-click="openDepartments">
                                        <div class="team_card_icon">üè¢</div>
                                        <h4>Departments</h4>
                                        <p>Manage departments</p>
                                    </div>
                                    <div class="zoho_team_card" t-on-click="openOrgChart">
                                        <div class="team_card_icon">üìä</div>
                                        <h4>Org Chart</h4>
                                        <p>Organization structure</p>
                                    </div>
                                    <div class="zoho_team_card" t-on-click="openLeaveRequests">
                                        <div class="team_card_icon">üìã</div>
                                        <h4>Leave Requests</h4>
                                        <p>Pending approvals</p>
                                    </div>
                                </div>

                                <t t-if="state.teamMembers.length">
                                    <div class="zoho_team_members_grid">
                                        <h3>My Team</h3>
                                        <div class="team_grid">
                                            <t t-foreach="state.teamMembers" t-as="member" t-key="member.id">
                                                <div class="team_member_card" t-on-click="() => this.openTeamMember(member)">
                                                    <div class="member_card_avatar">
                                                        <t t-if="member.image">
                                                            <img t-att-src="'data:image/png;base64,' + member.image"/>
                                                        </t>
                                                        <t t-else="">üë§</t>
                                                        <span class="member_card_status" 
                                                              t-att-class="{ online: member.status === 'checked_in' }"/>
                                                    </div>
                                                    <div class="member_card_name" t-esc="member.name"/>
                                                    <div class="member_card_job" t-esc="member.job"/>
                                                </div>
                                            </t>
                                        </div>
                                    </div>
                                </t>
                            </div>
                        </t>

                        <!-- ORGANIZATION VIEW -->
                        <t t-if="state.currentView === 'organization' and !embeddedState.isEmbeddedMode">
                            <div class="zoho_org_view">
                                <div class="zoho_view_header">
                                    <h2>Organization</h2>
                                    <p>Company-wide information and settings</p>
                                </div>
                                <div class="zoho_org_cards">
                                    <div class="zoho_org_card" t-on-click="openDepartments">
                                        <div class="org_card_icon">üè¢</div>
                                        <h4>Departments</h4>
                                    </div>
                                    <div class="zoho_org_card" t-on-click="openOrgChart">
                                        <div class="org_card_icon">üìä</div>
                                        <h4>Organization Chart</h4>
                                    </div>
                                    <div class="zoho_org_card" t-on-click="openJobApplications">
                                        <div class="org_card_icon">üéØ</div>
                                        <h4>Recruitment</h4>
                                    </div>
                                </div>
                            </div>
                        </t>

                        <!-- OPERATIONS VIEW -->
                        <t t-if="state.currentView === 'operations' and !embeddedState.isEmbeddedMode">
                            <div class="zoho_operations_view">
                                <div class="zoho_apps_search">
                                    <input type="text" 
                                           placeholder="Search applications..." 
                                           t-on-input="onSearchInput" 
                                           t-att-value="state.searchQuery"/>
                                </div>
                                <div class="zoho_apps_grid">
                                    <t t-foreach="filteredApps" t-as="app" t-key="app.id">
                                        <div class="zoho_app_item" t-on-click="() => this.onAppClick(app)">
                                            <div class="zoho_app_icon">
                                                <t t-if="getAppIcon(app)">
                                                    <img t-att-src="getAppIcon(app)"/>
                                                </t>
                                                <t t-else="">üì¶</t>
                                            </div>
                                            <span class="zoho_app_name" t-esc="app.name"/>
                                        </div>
                                    </t>
                                    <t t-if="!filteredApps.length">
                                        <div class="zoho_empty_apps">
                                            <div class="zoho_empty_icon">üîç</div>
                                            <p>No applications found</p>
                                        </div>
                                    </t>
                                </div>
                            </div>
                        </t>

                        <!-- PROFILE VIEW -->
                        <t t-if="state.currentView === 'profile' and !embeddedState.isEmbeddedMode">
                            <div class="zoho_profile_view">
                                <div class="zoho_profile_card">
                                    <div class="zoho_profile_header">
                                        <div class="zoho_profile_avatar">
                                            <t t-if="state.employee?.image_1920">
                                                <img t-att-src="'data:image/png;base64,' + state.employee.image_1920"/>
                                            </t>
                                            <t t-else="">üë§</t>
                                        </div>
                                        <h2 t-esc="state.employee?.name or 'User'"/>
                                        <p t-if="state.employee?.job_id" t-esc="state.employee.job_id[1]"/>
                                    </div>
                                    <div class="zoho_profile_body">
                                        <div class="zoho_profile_grid">
                                            <div class="zoho_profile_item">
                                                <label>Email</label>
                                                <p t-esc="state.employee?.work_email or '-'"/>
                                            </div>
                                            <div class="zoho_profile_item">
                                                <label>Phone</label>
                                                <p t-esc="state.employee?.mobile_phone or '-'"/>
                                            </div>
                                            <div class="zoho_profile_item">
                                                <label>Department</label>
                                                <p t-if="state.employee?.department_id" t-esc="state.employee.department_id[1]"/>
                                                <p t-else="">-</p>
                                            </div>
                                            <div class="zoho_profile_item">
                                                <label>Experience</label>
                                                <p t-esc="state.employee?.experience or '-'"/>
                                            </div>
                                        </div>

                                        <t t-if="state.skills.length">
                                            <div class="zoho_profile_skills">
                                                <h4>Skills</h4>
                                                <div class="profile_skills_grid">
                                                    <t t-foreach="state.skills" t-as="skill" t-key="skill.id">
                                                        <div class="profile_skill_item">
                                                            <span class="profile_skill_name" t-esc="skill.name"/>
                                                            <div class="profile_skill_bar">
                                                                <div class="profile_skill_fill" 
                                                                     t-attf-style="width: {{ skill.progress }}%"/>
                                                            </div>
                                                        </div>
                                                    </t>
                                                </div>
                                            </div>
                                        </t>

                                        <div class="zoho_profile_actions">
                                            <button class="zoho_primary_btn" t-on-click="openProfile">Edit Profile</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </t>
                    </div>
                </div>

                <!-- Floating Action Button -->
                <div class="zoho_fab">
                    <div class="fab_menu">
                        <div class="fab_item" t-on-click="addLeave" title="New Leave">üìÖ</div>
                        <div class="fab_item" t-on-click="addExpense" title="New Expense">üí≥</div>
                        <div class="fab_item" t-on-click="addProject" title="New Task">üìã</div>
                    </div>
                    <div class="fab_main">+</div>
                </div>
            </t>
        </div>
    </t>
</templates>